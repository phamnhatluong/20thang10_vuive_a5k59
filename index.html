<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Galaxy Upload Cloudinary + Firebase</title>
  <link rel="stylesheet" href="./style.css" />
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.152.2/build/three.module.js",
        "three/addons/controls/OrbitControls.js": "https://unpkg.com/three@0.152.2/examples/jsm/controls/OrbitControls.js"
      }
    }
  </script>
</head>

<body>
  <div id="container">
    <div id="image-input-container">
      <label>Chá»n áº£nh (sáº½ gá»­i lÃªn Cloudinary â†’ lÆ°u link trÃªn Firebase):</label><br />
      <input type="file" id="image-upload" accept="image/*" multiple />
      <br /><br />
      <textarea id="image-links" rows="4" cols="40" readonly></textarea><br />
      <button id="generate-link">Copy link hiá»ƒn thá»‹</button>
    </div>
  </div>

  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

    // âš™ï¸ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCnWKoYXwf4zz_3cndM9TXI7pJJmSALMa4",
      authDomain: "pnl-53051.firebaseapp.com",
      projectId: "pnl-53051",
      storageBucket: "pnl-53051.firebasestorage.app",
      messagingSenderId: "441869406071",
      appId: "1:441869406071:web:9daf7906bd8b9f47279b72",
      measurementId: "G-7NERQH0HLZ"
    };

    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);

    // âš™ï¸ Cloudinary Config
    const CLOUD_NAME = "dpihfxijg"; // ğŸ” thay báº±ng tÃªn Cloudinary cá»§a báº¡n
    const UPLOAD_PRESET = "20-10-pnl"; // ğŸ” thay báº±ng preset khÃ´ng cáº§n auth

    const uploadInput = document.getElementById("image-upload");
    const imageLinksTextarea = document.getElementById("image-links");

    uploadInput.addEventListener("change", async (event) => {
      const files = event.target.files;
      const cloudinaryURLs = [];

      for (const file of files) {
        try {
          // === 1ï¸âƒ£ Upload áº£nh lÃªn Cloudinary ===
          const formData = new FormData();
          formData.append("file", file);
          formData.append("upload_preset", UPLOAD_PRESET);

          const cloudRes = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
            method: "POST",
            body: formData
          });

          const cloudData = await cloudRes.json();
          if (!cloudData.secure_url) throw new Error("Cloudinary upload failed");

          const cloudUrl = cloudData.secure_url;
          cloudinaryURLs.push(cloudUrl);
          console.log("âœ… Uploaded to Cloudinary:", cloudUrl);

        } catch (err) {
          console.error("âŒ Lá»—i upload Cloudinary:", err);
          alert("Upload áº£nh lÃªn Cloudinary tháº¥t báº¡i!");
        }
      }

      // === 2ï¸âƒ£ LÆ°u danh sÃ¡ch link vÃ o Firebase ===
      try {
        const jsonBlob = new Blob([JSON.stringify(cloudinaryURLs, null, 2)], { type: "application/json" });
        const fileRef = ref(storage, `urls/${Date.now()}.json`);
        await uploadBytes(fileRef, jsonBlob);
        const jsonURL = await getDownloadURL(fileRef);

        imageLinksTextarea.value = jsonURL;
        alert("âœ… Upload thÃ nh cÃ´ng! Link danh sÃ¡ch áº£nh lÆ°u trÃªn Firebase.");

      } catch (err) {
        console.error("âŒ Lá»—i lÆ°u link lÃªn Firebase:", err);
        alert("KhÃ´ng thá»ƒ lÆ°u link vÃ o Firebase.");
      }
    });

    // === 3ï¸âƒ£ Copy link JSON Firebase khi nháº¥n nÃºt ===
    document.getElementById("generate-link").addEventListener("click", () => {
      const text = imageLinksTextarea.value.trim();
      if (!text) return alert("ChÆ°a cÃ³ link nÃ o Ä‘á»ƒ copy!");
      navigator.clipboard.writeText(text);
      alert("âœ… Link Firebase Ä‘Ã£ Ä‘Æ°á»£c sao chÃ©p!");
    });
  </script>

  <!-- Galaxy hiá»ƒn thá»‹ áº£nh -->
  <script type="module" src="./galaxy.js"></script>
</body>

</html>
